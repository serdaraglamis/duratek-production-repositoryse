const e=window.App.h;class t{constructor(){this.isReady=!1,this.selectedFirstLevel=0,this.changeTrigger=!1,this.openedProductIndex=null,this.mailData={source:"product",name:"",surname:"",email:"",phone:"",company:"",position:"",message:""},this.productSectors=[],this.productCategories=[],this.productSystems=[],this.allCategories=[],this.renderedCategoryType="",this.systemDirectRendered=!1}componentWillLoad(){fetch(`${window.apiBase}/product-categories`).then(e=>e.json()).then(e=>{fetch(`${window.apiBase}/products`).then(t=>{t.json().then(t=>{this.allCategories=e,this.products=t,this.calculateCategoryLevels()})})}),window.addEventListener("popstate",e=>{if(e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation(),"system"!==this.renderType||this.systemDirectRendered)history.back();else{this.renderType="category";let e=window.location.pathname;const t={Title:this.currentCategory.languages[this.language].title,Url:document.location.origin+e};history.replaceState(t,t.Title,t.Url),this.changeTrigger=!this.changeTrigger}},!1)}async calculateCategoryLevels(){this.productSectors=await this.calculateProductSectors(),this.productCategories=await this.calculateProductCategories(),this.productSystems=await this.calculateProductSystems(),this.selectedCategoryId=this.calculateSectorCategories(this.productSectors[0]._id)[0]._id,this.calculateCategorySystems(this.selectedCategoryId).length?(this.renderedCategoryType="sector",this.renderCategoryId=this.calculateCategorySystems(this.selectedCategoryId)[0]._id):(this.renderedCategoryType="category",this.renderCategoryId=this.selectedCategoryId),this.calculateCurrentDetail(),this.isReady=!0}calculateProductSectors(){return this.allCategories.filter(e=>!e.parents.length)}calculateProductCategories(){return this.allCategories.filter(e=>1===e.parents.length)}calculateProductSystems(){return this.allCategories.filter(e=>2===e.parents.length)}mapProductsToCategories(){this.allCategories.forEach(e=>{this.products.forEach(t=>{t.categories.includes(e._id)&&e.products.push(t)})})}firstLevelClicked(e,t){this.selectedFirstLevel=t,this.selectedCategoryId=this.calculateSectorCategories(e._id)[0]._id,this.calculateCategorySystems(this.selectedCategoryId).length?(this.renderedCategoryType="sector",this.renderCategoryId=this.calculateCategorySystems(this.selectedCategoryId)[0]._id):(this.renderedCategoryType="category",this.renderCategoryId=this.selectedCategoryId)}subLevelClicked(e,t){e.preventDefault(),this.selectedCategoryId=t._id,this.calculateCategorySystems(this.selectedCategoryId).length?(this.renderedCategoryType="sector",this.renderCategoryId=this.calculateCategorySystems(this.selectedCategoryId)[0]._id):(this.renderedCategoryType="category",this.renderCategoryId=this.selectedCategoryId)}sectorClicked(e,t){e.preventDefault(),this.renderCategoryId=t._id}getProductsForSelected(){return this.allCategories.find(e=>e._id===this.renderCategoryId)}getRenderedType(){switch(this.renderedCategoryType){case"category":return"KATEGORİ";case"sector":return"SEKTÖR"}}calculateSectorCategories(e){return this.productCategories.filter(t=>t.parents.includes(e))}calculateCategorySystems(e){return this.productSystems.filter(t=>t.parents.includes(e))}calculateCurrentDetail(){for(let e=1;e<this.paths.length-window.rootLevel;e++)switch(e){case 1:this.renderType="sector",this.sectorPath=this.paths[window.rootLevel+e];break;case 2:this.renderType="category",this.categoryPath=this.paths[window.rootLevel+e];break;case 3:this.categoryPath=this.paths[window.rootLevel+2];let t=this.allCategories.find(e=>e.languages[this.language].path.includes(this.categoryPath));console.log("Current Categ Found",t),this.systemPath=this.paths[window.rootLevel+e],this.renderedSystem=this.allCategories.find(e=>e.languages[this.language].path.includes(this.systemPath)&&e.parents.includes(t._id)),document.title=this.renderedSystem.languages[this.language].title+" | "+window.pageName+" | Duratek",this.renderType="system",this.systemDirectRendered=!0}this.currentSector=this.productSectors.find(e=>e.languages[this.language].path.includes(this.sectorPath)),this.categoryPath&&(this.currentCategory=this.productCategories.find(e=>e.languages[this.language].path.includes(this.categoryPath)),document.title=this.currentCategory.languages[this.language].title+" | "+window.pageName+" | Duratek")}categoryClicked(e){if(void 0!==history.pushState){const t={Title:e.languages[this.language].title,Url:e.languages[this.language].path};history.pushState(t,t.Title,t.Url)}this.currentCategory=e,document.title=this.currentCategory.languages[this.language].title+" | "+window.pageName+" | Duratek",this.changeTrigger=!this.changeTrigger}systemClicked(e){if(void 0!==history.pushState){const t={Title:e.languages[this.language].title,Url:`${this.currentCategory.languages[this.language].path}/${e.languages[this.language].path}`};history.pushState(t,t.Title,t.Url)}this.renderedSystem=e,document.title=this.renderedSystem.languages[this.language].title+" | "+window.pageName+" | Duratek",this.renderType="system",this.changeTrigger=!this.changeTrigger}renderAsideBlock(){if(this.currentSector)return e("aside",{class:"module-720-aside"},e("div",{class:"module-722"},e("div",{class:"module-722-title","data-aos":"fade-up"},this.currentSector.languages[this.language].title),e("ul",{class:"module-722-list"},this.calculateSectorCategories(this.currentSector._id).map(t=>{const a=this.calculateCategorySystems(t._id);return e("li",{class:`module-722-list-item ${a.length?"has-subnav":""} accordion-item ${this.currentCategory._id===t._id?"active":""}`,"data-aos":"fade-up"},e("a",{onClick:()=>this.categoryClicked(t),href:"javascript:void(0);",title:"",class:"accordion-link"},t.languages[this.language].title),a.length?e("div",{class:"module-722-sublist accordion-content"},a.map(t=>e("div",{class:"module-722-sublist-item"},e("a",{onClick:()=>this.systemClicked(t),href:"javascript:void(0);",title:"",class:"","data-modal":"modal","data-target":"#productDetail"},t.languages[this.language].title)))):"")}))))}systemModalCancelClicked(){let e=window.location.pathname;(e=e.split("/")).pop(),e=e.join("/");const t={Title:this.currentCategory.languages[this.language].title,Url:document.location.origin+e};history.replaceState(t,t.Title,t.Url),this.renderType="category",this.changeTrigger=!this.changeTrigger}async sendMail(e){e.preventDefault(),this.mailData.currentCategory=this.currentCategory,this.mailData.currenctSystem=this.renderedSystem,await fetch(`${window.apiBase}/sendmail`,{body:JSON.stringify(this.mailData),method:"POST",headers:{"content-type":"application/json"}}).then(()=>{siiimpleToast.success(this.getStaticText("formGonderildi")),this.mailData={source:"product",name:"",surname:"",email:"",phone:"",company:"",position:"",message:""}})}getStaticText(e){return window.staticTexts[e][this.language]}renderMailTemplate(){return e("div",{class:"module-730-body-item"},e("div",{class:"title"},"Detaylı Ürün Bilgi Talebi ",e("span",{class:"info"},"Ürün hakkında detaylı bilgi almak için iletişim formunu doldurmanız gerekmektedir.")),e("div",{class:"content"},e("form",{class:"module-70 validated"},e("div",{class:"module-70-body"},e("div",{class:"module-70-item","data-aos":"fade-up"},e("div",{class:"has-float-label"},e("input",{onInput:e=>this.mailData.name=e.target.value,value:this.mailData.name,id:"fname",type:"text",placeholder:this.getStaticText("formIsminiz")}),e("label",{htmlFor:"fname"},this.getStaticText("formIsim")))),e("div",{class:"module-70-item","data-aos":"fade-up"},e("div",{class:"has-float-label"},e("input",{onInput:e=>this.mailData.surname=e.target.value,value:this.mailData.surname,id:"lname",type:"text",placeholder:this.getStaticText("formSoyIsminiz")}),e("label",{htmlFor:"lname"},this.getStaticText("formSoyIsim")))),e("div",{class:"module-70-item","data-aos":"fade-up"},e("div",{class:"has-float-label"},e("input",{onInput:e=>this.mailData.email=e.target.value,value:this.mailData.email,id:"eposta",type:"text",placeholder:this.getStaticText("formEpostaAdresi")}),e("label",{htmlFor:"eposta"},this.getStaticText("formEposta")))),e("div",{class:"module-70-item","data-aos":"fade-up"},e("div",{class:"has-float-label"},e("input",{onInput:e=>this.mailData.phone=e.target.value,value:this.mailData.phone,id:"pnumber",type:"tel",placeholder:this.getStaticText("formTelefonNumarasi")}),e("label",{htmlFor:"pnumber"},this.getStaticText("formTelefon")))),e("div",{class:"module-70-item","data-aos":"fade-up"},e("div",{class:"has-float-label"},e("input",{onInput:e=>this.mailData.company=e.target.value,value:this.mailData.company,id:"companyname",type:"text",placeholder:this.getStaticText("formSirketIsminiz")}),e("label",{htmlFor:"companyname"},this.getStaticText("formSirket")))),e("div",{class:"module-70-item","data-aos":"fade-up"},e("div",{class:"has-float-label"},e("input",{onInput:e=>this.mailData.position=e.target.value,value:this.mailData.position,id:"jobtitle",type:"text",placeholder:this.getStaticText("formGorevYaziniz")}),e("label",{htmlFor:"jobtitle"},this.getStaticText("formGorev")))),e("div",{class:"module-70-item col-full","data-aos":"fade-up"},e("div",{class:"has-float-label"},e("textarea",{onInput:e=>this.mailData.message=e.target.value,value:this.mailData.message,id:"message",placeholder:this.getStaticText("formMesajiniziYaziniz")}),e("label",{htmlFor:"message"},this.getStaticText("formMesaj"))))),e("div",{class:"module-70-footer"},e("a",{onClick:this.sendMail.bind(this),class:"a-btn white with-triangle",href:"",title:""},this.getStaticText("formGonder"))))))}module724Clicked(e,t){console.warn(t),this.openedProductIndex=this.openedProductIndex===e?null:e;const a=document.querySelector(`.module-724-item-content.content-${e}`),s=document.querySelectorAll(".module-724-item-content");s&&(s.forEach(e=>e.style.maxHeight=null),null===this.openedProductIndex||(a.style.maxHeight=a.scrollHeight+96+"px")),this.changeTrigger=!this.changeTrigger}renderSystemDetail(){if(this.renderedSystem)return console.log("Rendering Here",this.renderedSystem),e("div",{id:"productDetail",class:"modal","aria-hidden":"system"!==this.renderType},e("div",{class:"modal-backdrop"}),"system"===this.renderType?e("div",{class:"container modal-container"},e("div",{class:"modal-header"},e("div",{class:"title"}),e("a",{class:"modal-close close",onClick:this.systemModalCancelClicked.bind(this),title:""},e("span",{class:"d-cross-light"}))),e("div",{class:"modal-body"},e("div",{class:"module-730"},e("div",{class:"module-730-header"},e("h1",null,this.renderedSystem.languages[this.language].title," Sistemleri")),e("div",{class:"module-730-body"},e("div",{class:"module-730-body-item",innerHTML:this.renderedSystem.languages[this.language].description}),e("div",{class:"module-730-body-item"},e("div",{class:"title"},this.renderedSystem.languages[this.language].title," ",this.getStaticText("urunler")),e("div",{class:"content"},this.renderedSystem.products.length?e("div",{class:"module-724"},e("div",{class:"module-724-section body"},this.renderedSystem.products.map((t,a)=>{const s=this.getProductDetailById(t);if(console.log("PProduct Arrived",s),s.isPublished)return e("div",{class:`module-724-item accordion-item ${this.openedProductIndex===a?"active":""}`,onClick:e=>this.module724Clicked(a,e)},e("a",{class:"module-724-item-link accordion-link",href:"javascript:void(0);",title:""},e("span",{class:"d-arrow-right arrow"}),e("span",{class:"name"},s.languages[this.language].title),e("span",{class:"code"},s.productCode)),e("div",{class:`module-724-item-content content-${a} accordion-content`,innerHTML:s.languages[this.language].description}))}))):e("div",null,this.getStaticText("urunYok")))),this.renderMailTemplate()),e("div",{class:"module-730-footer"})))):"")}getProductDetailById(e){return this.products.find(t=>t._id===e)||null}getProductsArrayByIds(e){let t=[];return e.forEach(e=>{const a=this.products.find(t=>t._id===e);a&&t.push(a)}),t}renderMainBlock(){if(this.currentCategory){const t=this.calculateCategorySystems(this.currentCategory._id);return t.length?e("div",{class:"module-720-body"},e("h2",{"data-aos":"fade-up"},this.currentCategory.languages[this.language].title),e("p",{innerHTML:this.currentCategory.languages[this.language].description,"data-aos":"fade-up"}),e("div",{class:"module-723","data-aos":"fade-up"},e("div",{class:"module-723-header","data-aos":"fade-up"},e("h3",null,this.currentCategory.languages[this.language].title," Sistemleri")),e("div",{class:"module-723-body","data-aos":"fade-up"},t.map(t=>e("div",{class:"module-723-item","data-aos":"fade-up"},e("a",{onClick:()=>this.systemClicked(t),class:"module-723-item-link",href:"javascript:void(0);",title:"","data-modal":"modal","data-target":"#productDetail"},t.languages[this.language].title)))),e("div",{class:"module-723-footer"}))):e("div",{class:"module-720-body"},e("div",{class:"module-730"},e("div",{class:"module-730-header"},e("h1",null,this.currentCategory.languages[this.language].title," Sistemleri")),e("div",{class:"module-730-body"},e("div",{class:"module-730-body-item"}),e("div",{class:"module-730-body-item"},e("div",{class:"title"},this.currentCategory.languages[this.language].title," Ürünleri"),e("div",{class:"content"},this.getProductsArrayByIds(this.currentCategory.products).length?e("div",{class:"module-724"},e("div",{class:"module-724-section body"},this.getProductsArrayByIds(this.currentCategory.products).map((t,a)=>{if(t.isPublished)return e("div",{class:`module-724-item accordion-item ${this.openedProductIndex===a?"active":""}`,onClick:e=>this.module724Clicked(a,e)},e("a",{class:"module-724-item-link accordion-link",href:"javascript:void(0);",title:""},e("span",{class:"d-arrow-right arrow"}),e("span",{class:"name"},t.languages[this.language].title),e("span",{class:"code"},t.productCode)),e("div",{class:`module-724-item-content content-${a} accordion-content`,innerHTML:t.languages[this.language].description}))}))):e("div",null,this.getStaticText("urunYok")))),this.renderMailTemplate()),e("div",{class:"module-730-footer"})))}}render(){return e("section",{class:"module-720"},e("div",{class:"container module-720-container"},this.renderAsideBlock(),this.renderMainBlock(),this.renderSystemDetail()))}static get is(){return"urunler-page"}static get properties(){return{changeTrigger:{state:!0},componentData:{type:"Any",attr:"component-data"},isReady:{state:!0},language:{type:String,attr:"language"},paths:{type:String,attr:"paths"},renderCategoryId:{state:!0},selectedFirstLevel:{state:!0}}}static get style(){return".accordion-item.active .module-722-sublist{max-height:259px!important}.module-724-item.accordion-item.active .module-724-item-content.accordion-content{max-height:202px}"}}export{t as UrunlerPage};